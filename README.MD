# üíà Barber√≠a ‚Äî Backend (FastAPI + MongoDB)

Backend para la gesti√≥n integral de una barber√≠a: **clientes, barberos, servicios, turnos, rese√±as, notificaciones y anal√≠ticas**.  
Construido con **FastAPI**, **MongoDB (Motor)** y **JWT** para autenticaci√≥n.

---

## üöÄ Stack
- **Framework:** FastAPI
- **DB:** MongoDB (driver **motor** / `pymongo`)
- **Auth:** JWT (login/register)
- **Validaci√≥n:** Pydantic v2
- **ASGI server:** uvicorn
- **ENV:** `python-dotenv`

> Puerto por defecto: **8001** (definido en `server.py`).

---

## üìÅ Estructura (resumen)
```
backend/
‚îú‚îÄ server.py            # App principal FastAPI, rutas base y auth
‚îú‚îÄ database.py          # Conexi√≥n a MongoDB y helpers
‚îú‚îÄ models.py            # Modelos Pydantic (User, Barber, Service, Appointment, etc.)
‚îú‚îÄ analytics.py         # Router de anal√≠ticas  (/api/analytics)
‚îú‚îÄ reviews.py           # Router de rese√±as      (/api/reviews)
‚îú‚îÄ notifications.py     # Router de notificaciones (/api/notifications)
‚îú‚îÄ whatsapp_routes.py   # Router de WhatsApp     (/api/whatsapp)
‚îú‚îÄ requirements.txt     # Dependencias
‚îî‚îÄ .env                 # Variables de entorno (no subir)
```
> **Nota:** El proyecto trae una carpeta `venv/` en el ZIP que **no debe** subirse al repo. Us√° `requirements.txt` para recrear el entorno.

---

## üîê Variables de entorno (`backend/.env`)
Solo **nombres** (no subas valores reales):
```ini
MONGO_URL=mongodb+srv://...
DB_NAME=barberia
JWT_SECRET=super_secreto
PORT=8001
```
- `MONGO_URL`: cadena de conexi√≥n a MongoDB.
- `DB_NAME`: nombre de la base.
- `JWT_SECRET`: secreto para firmar tokens JWT.
- `PORT`: puerto del backend (coincide con `server.py`).

---

## üì¶ Instalaci√≥n y ejecuci√≥n

### 1) Clonar y posicionarse
```bash
git clone https://github.com/ajoca/Barberia.git
cd Barberia/backend
```

### 2) Crear y activar entorno virtual
```bash
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/Mac
# source venv/bin/activate
```

### 3) Instalar dependencias
```bash
pip install -r requirements.txt
```

### 4) Configurar `.env`
Crear `backend/.env` con las claves indicadas arriba.

### 5) Ejecutar
```bash
python server.py
# o
uvicorn server:app --host 0.0.0.0 --port 8001 --reload
```
La API quedar√° en: `http://localhost:8001`  
Documentaci√≥n autom√°tica: `http://localhost:8001/docs` (si est√° habilitada por defecto).

---

## üîë Autenticaci√≥n
- **POST** `/api/auth/register` ‚Üí alta de usuario
- **POST** `/api/auth/login` ‚Üí devuelve **JWT**

Us√° el header:  
`Authorization: Bearer <tu_token>` en endpoints protegidos.

---

## üß≠ Endpoints principales (detectados)

### Base (server.py)
- **POST** `/api/auth/register`
- **POST** `/api/auth/login`
- **GET**  `/api/customers`
- **POST** `/api/customers`
- **PUT**  `/api/customers/{customer_id}`
- **GET**  `/api/barbers`
- **POST** `/api/barbers`
- **PUT**  `/api/barbers/{barber_id}`
- **GET**  `/api/services`
- **POST** `/api/services`
- **PUT**  `/api/services/{service_id}`
- **POST** `/api/appointments`
- **GET**  `/api/appointments`
- **PUT**  `/api/appointments/{appointment_id}/status`
- **GET**  `/api/barbers/{barber_id}/availability`
- **GET**  `/api/health`

### Anal√≠ticas (`/api/analytics`)
Rutas de m√©tricas e informes (volumen de turnos, ingresos, etc.).

### Rese√±as (`/api/reviews`)
CRUD de rese√±as de clientes.

### Notificaciones (`/api/notifications`)
Plantillas y env√≠o de notificaciones (email/push/otros, seg√∫n implementaci√≥n).

### WhatsApp (`/api/whatsapp`)
- **GET** `/api/whatsapp/status`
- **GET** `/api/whatsapp/qr-code`
- **POST** `/api/whatsapp/reconnect`
- **POST** `/api/whatsapp/disconnect`
- **POST** `/api/whatsapp/send-message`
- **POST** `/api/whatsapp/send-appointment-notification`
- **GET** `/api/whatsapp/messages`
- **GET** `/api/whatsapp/appointments/reminders`
- **POST** `/api/whatsapp/messages`

> El microservicio externo se configura con `WHATSAPP_SERVICE_URL` (por defecto `http://localhost:8002`).

---

## üß± Modelos principales (Pydantic)
- **User** (roles, hash de contrase√±a, JWT)
- **Customer**, **Barber**, **Service**
- **Appointment** (estado, horarios, disponibilidad)
- **Review** (puntuaci√≥n/comentario)
- **WhatsAppMessage** / **WhatsAppStatus**

> Ver `models.py` para campos detallados y validaciones.

---

## ‚úÖ Buenas pr√°cticas del repo
- Confirmar que `.venv/`, `venv/`, `__pycache__/`, `.env` y archivos locales est√©n en **.gitignore**.
- Commits at√≥micos y descriptivos.
- Issues/PRs para nuevas features o bugs.

---

## üß™ Pr√≥ximos pasos sugeridos
- A√±adir **tests** (pytest) y flujo CI.
- Especificar **roles** y permisos por endpoint.
- Plantillas de notificaci√≥n parametrizables.
- Dockerizaci√≥n opcional (compose para mongo + api).
- Paginaci√≥n y filtros en listados.

---

## üë§ Autor
**Alan Canto (Ajoca)** ‚Äî Montevideo, Uruguay  
GitHub: https://github.com/ajoca

